# test

import requests
import pandas as pd
from bs4 import BeautifulSoup
import csv


# keywords = ['pigmentation',
#             'pigmentation disorders',
#             'Skin Pigmentation Disorders',
#             'Lupus',
#             'Systemic Lupus Erythematosus',
#             'Acne',
#             'Rosacea',
#             'Acne Rosacea',
#             'Poison Ivy',
#             'Hives',
#             'Eczema',
#             'Psoriasis']

# disease = {
#     'Pigmentation Disorders': ['Vitiligo', 'Albinism', 'Melasma', 'Freckles', 'Hypopigmentation', 'Hyperpigmentation'],
#     'Connective Tissue Diseases': ['Lupus', 'Scleroderma', 'Dermatomyositis'],
#     'Acne': ['Acne Vulgaris', 'Acne Rosacea'],
#     'Contact Dermatitis': ['Poison Ivy Dermatitis', 'Contact Dermatitis'],
#     'Vascular Tumors': ['Hemangioma', 'Kaposiform Hemangioendothelioma'],
#     'Urticaria Hives': ['Chronic Idiopathic Urticaria', 'Physical Urticaria'],
#     'Atopic Dermatitis': ['Eczema', 'Contact Dermatitis'],
#     'Bullous Disease': ['Pemphigus', 'Bullous Pemphigoid', 'Epidermolysis Bullosa'],
#     'Hair Loss': ['Alopecia Areata', 'Androgenetic Alopecia', 'Telogen Effluvium'],
#     'Fungal Infections': ['Ringworm (Tinea Corporis)', 'Candidiasis', 'Tinea Versicolor'],
#     'Psoriasis': ['Plaque Psoriasis', 'Guttate Psoriasis', 'Inverse Psoriasis'],
#     'Melanoma': ['Superficial Spreading Melanoma', 'Nodular Melanoma', 'Lentigo Maligna Melanoma'],
#     'Nail Fungus': ['Onychomycosis', 'Paronychia'],
#     'Infestations and Bites': ['Scabies', 'Lyme Disease'],
#     'Eczema': ['Atopic Dermatitis', 'Contact Dermatitis'],
#     'Exanthems and Eruptions': ['Measles', 'Roseola'],
#     'Herpes and STDs': ['Herpes Simplex', 'HPV (Human Papillomavirus)', 'Syphilis'],
#     'Benign Tumors': ['Seborrheic Keratosis', 'Dermatofibroma'],
#     'Malignant Lesions': ['Basal Cell Carcinoma', 'Squamous Cell Carcinoma', 'Merkel Cell Carcinoma'],
#     'Vasculitis': ['Hypersensitivity Vasculitis', 'Granulomatosis with Polyangiitis'],
#     'Bacterial Infections': ['Cellulitis', 'Impetigo'],
#     'Viral Infections': ['Warts', 'Molluscum Contagiosum'],
# }

### ADD NAME OF WEBSITE HERE!!!!!!
websites = ['Mayo Clinic', 
            'Cleveland clinic']

disease = {
    'Pigmentation Disorders': ['Vitiligo', 'Albinism', 'Melasma', 'Freckles', 'Hypopigmentation', 'Hyperpigmentation']}

data = {
    'Disease': [],
    'Keyword': [],
    'Website': [],
    'Symptoms':[]
}
df = pd.DataFrame(data)


for website in websites:
    for disease_name, keywords in disease.items():
        d_cat = disease_name
        for keyword in keywords:
            query = f'{website} {keyword} symptoms'
            search_url = f'https://www.google.com/search?q={query}'
            # print(search_url)  

            response = requests.get(search_url)
            # print(response.status_code)
            if response.status_code == 200:
                soup = BeautifulSoup(response.content, 'html.parser')
                result_links = soup.find_all('a')
                url_list =[]
                for link in result_links:
                    if link.get("href").startswith("/url"):
                        link_url = link.get("href")[7:-86]
                        if len(url_list) <1:
                            url_list.append(link_url)

                # print(url_list)

                for link_url in url_list:
                    # visit page
                    page_response = requests.get(link_url)
                    if page_response.status_code == 200:
                        page_soup = BeautifulSoup(page_response.content, 'html.parser')
                        # mayoclinic
                        if "mayoclinic.org" in link_url:
                            symptom_h = page_soup.find(lambda tag: (tag.name in ['h2'])
                                                            and 'symptoms' in tag.get_text().lower()
                                                        )
                            # print(f"{keyword} {link_url} symptoms:")
                            symptoms_components = symptom_h.find_next_siblings(lambda tag: (tag.name in ['p','ul']))
                            if not symptoms_components:
                                symptoms_components = symptom_h.find_next(lambda tag: (tag.name in ['div']))
                                while not symptoms_components:
                                    symptoms_components = symptoms_components.find_next(lambda tag: (tag.name in ['p','ul','div']))
                            symptoms_text = ''
                            for sym_com in symptoms_components:
                                symptoms_text += sym_com.get_text()

                            # for sym_com in symptoms_components:
                            #     print(sym_com.get_text())

                        elif "clevelandclinic.org" in link_url:
                            symptom_h = page_soup.find(lambda tag: (tag.name in ['h1','h2','h3','section','div','p'])
                                                            and 'symptoms' in tag.get_text().lower()
                                                            and 'of' in tag.get_text().lower()
                                                        )
                            # print(f"{keyword} {link_url} symptoms:")
                            symptoms_components = symptom_h.find_next(lambda tag: (tag.name in ['p','ul','h4']))
                            if not symptoms_components:
                                symptoms_components = symptom_h.find_next(lambda tag: (tag.name in ['div']))
                                while not symptoms_components:
                                    symptoms_components = symptoms_components.find_next(lambda tag: (tag.name in ['p','ul','div']))
                        
                            symptoms_text = ''
                            for sym_com in symptoms_components:
                                symptoms_text += sym_com.get_text()

                        ###### ADD ELIF HERE!!!!

                    new_data = {
                        'Disease': [disease_name],
                        'Keyword': [keyword],
                        'Website': [website],
                        'Symptoms': [symptoms_text]
                    }
                    new_df = pd.DataFrame(new_data)
                    df = pd.concat([df, new_df])


print(df)



            